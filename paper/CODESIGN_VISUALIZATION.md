# 协同设计框架可视化说明

## 论文结构的分层关系

```
┌────────────────────────────────────────────────────────────┐
│                   应用层（Part 3）                          │
│                                                             │
│  ┌──────────────────────┐      ┌──────────────────────┐   │
│  │   第三章：硬件案例    │◄────►│   第四章：调度案例    │   │
│  │   Coral NPU处理器     │  协  │   LLM推理调度        │   │
│  │                      │  同  │                      │   │
│  │ - 流水线设计         │  反  │ - 优先级调度         │   │
│  │ - 执行单元           │  馈  │ - 批处理             │   │
│  │ - 缓存/内存          │  闭  │ - 资源管理           │   │
│  │ - 性能特性           │  环  │ - 性能模型           │   │
│  └──────────────────────┘      └──────────────────────┘   │
│          ▲                               ▲                  │
│          │ 约束与机会                    │ 需求与反馈       │
└──────────┼───────────────────────────────┼──────────────────┘
           │                               │
           └───────────────┬───────────────┘
                           │
┌──────────────────────────┴──────────────────────────────────┐
│           框架层（Part 2）：通用建模框架                      │
│   Port|Component|Connection|Pipeline|Stage抽象             │
│   （统一支持硬件模拟和调度系统评估）                        │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────┴──────────────────────────────────┐
│           基础层（Part 1）：事件驱动模拟理论                 │
│   事件队列|调度器|时间模型|性能监测                         │
│   （为硬件和软件系统提供统一的执行模型）                   │
└───────────────────────────────────────────────────────────────┘
```

## 硬件-调度的协同优化循环

```
                    协同优化迭代
        
        ┌─────────────────────────────────────┐
        │                                     │
        ▼                                     │
   ┌─────────────┐                           │
   │ 调度设计    │                           │
   │ (第四章)    │                           │
   └─────────────┘                           │
        │                                     │
        │ "缓存miss多"                      │
        │ "内存带宽不足"                    │
        │ "寄存器压力大"                    │
        ▼                                     │
   ┌──────────────────────┐                  │
   │  模拟器评估          │                  │
   │ (第二章框架)         │                  │
   │ + 硬件参数(第三章)    │                  │
   └──────────────────────┘                  │
        │                                     │
        │ 性能分析与瓶颈识别                │
        ▼                                     │
   ┌──────────────────────┐                  │
   │ 硬件优化方向         │                  │
   │ (第三章微体系结构)    │                  │
   │ - 缓存大小           │                  │
   │ - 内存带宽           │                  │
   │ - 向量宽度           │                  │
   └──────────────────────┘                  │
        │                                     │
        │ 更新硬件配置                      │
        ▼                                     │
   ┌──────────────────────┐                  │
   │ 调度性能重新评估      │                  │
   │ (反馈回调度设计)      │                  │
   └──────────────────────┘                  │
        │                                     │
        │ 调度算法微调                      │
        └─────────────────────────────────────┘
```

## 阅读路径的多维导航

```
                    协同设计视角
                       │
        ┌──────────────┼──────────────┐
        ▼              ▼              ▼
    硬件优先     快速理解      调度优先
    (设计师)     (10小时)      (工程师)
        │              │              │
        ├─快速┤        │        ├─快速┤
        │概览│        │        │概览│
        │    │        │        │    │
        ├─第1章◄──────┼────────►第1章┤
        │    │        │        │    │
        ├─第2章 ─────┼────── 第2章┤
        │    │        │        │    │
        ├─第3章◄──────┼────────►第4章┤
        │全部 │  协同  │  全部 │    │
        │    │        │        │    │
        ├─第4章  ─┼─  第3章 ┤
        │ 4.1-4.3  │ 3.1,3.3,3.6
        │    │        │        │    │
        └────┘        │        └────┘
                      │
              ┌───────┴────────┐
              ▼                ▼
         完整学习           参考查询
        (全部章节)    (快速定位关键内容)
```

## 每章对其他章的引用关系

### 第一章 → 其他章
```
第1章 (事件驱动基础)
  │
  ├─→ 第2章：框架设计中使用事件驱动模型
  │   (如何用事件表示硬件和调度的异步性)
  │
  ├─→ 第3章：硬件建模中的时间同步
  │   (多时钟域、流水线的时序正确性)
  │
  └─→ 第4章：调度系统的性能监测
      (事件驱动实现调度器的决策反馈)
```

### 第二章 → 其他章
```
第2章 (通用框架)
  │
  ├─→ 第3章：用Port/Component/Pipeline建模处理器
  │   (如何用抽象表示硬件结构)
  │
  └─→ 第4章：用相同抽象建模调度系统
      (调度队列=Component, 资源=Port, 处理=Pipeline)
```

### 第三章 ↔ 第四章 (关键协同)
```
第3章 (硬件约束)  ◄────────►  第4章 (调度需求)

3.1 硬件架构         4.1 系统需求
    ▼                   ▲
3.2 流水线约束   →   4.2 调度建模
    ▼                   ▲
3.3 资源模型     →   4.4 并发调度
    ▼                   ▲
3.5 向量资源     →   4.3 内存管理
    ▼                   ▲
3.6 优化机会     →   4.6 资源优化
    ▼                   ▲
3.7 硬件集成     ←   4.5 性能验证
```

## 协同设计工作流

```
                    设计流程循环
        
      ┌──────────────────────────────┐
      │  Phase 1: 硬件架构设计        │
      │  (第三章：处理器设计)         │
      │  输出：硬件规格与约束        │
      └────────────┬─────────────────┘
                   │
      ┌────────────▼─────────────────┐
      │  Phase 2: 调度算法设计        │
      │  (第四章：推理调度)          │
      │  输入：硬件约束              │
      │  输出：调度策略与需求        │
      └────────────┬─────────────────┘
                   │
      ┌────────────▼─────────────────┐
      │  Phase 3: 模拟器评估          │
      │  (第二章框架+第一章理论)      │
      │  评估：调度性能/硬件利用率   │
      │  输出：性能数据与瓶颈分析    │
      └────────────┬─────────────────┘
                   │
      ┌────────────▼─────────────────┐
      │  Phase 4: 反馈与优化          │
      │  决策：                      │
      │  - 硬件改进方向？            │
      │  - 调度算法改进？            │
      │  - 性能收益 vs 成本权衡      │
      └────────────┬─────────────────┘
                   │
            反馈循环判断
                   │
        是否需要继续迭代？
          /        │        \
        是        否       基准达成
        │         │            │
        └─────┬───┘            │
              │                │
           返回 Phase 1      完成设计
            (改进硬件)        或 Phase 5
                            (扩展应用)
```

## 核心创新点的对应关系

| 创新点 | 来源章节 | 在应用中的体现 |
|-------|--------|----------------|
| **事件驱动执行模型** | 第1章 | 硬件和调度的异步性统一处理 |
| **五层框架抽象** | 第2章 | 可同时建模处理器和调度系统 |
| **硬件约束模型** | 第3章 | 调度设计的设计空间定义 |
| **性能分析工具** | 第1-2章 | 量化调度-硬件的影响关系 |
| **协同设计方法** | 第3-4章 | 迭代优化的反馈闭环 |

## 对不同读者的指导

### 硬件架构师
```
关注: 硬件设计如何影响软件
核心路径: 
  第1-2章 (基础框架) 
    ▼
  第3章 (硬件设计)
    ▼
  第4章 4.1, 4.2, 4.5 (了解调度对硬件的需求)
```

### 系统软件工程师
```
关注: 软件如何在硬件约束下优化
核心路径:
  第1-2章 (基础框架)
    ▼
  第3章 3.1, 3.3, 3.6 (理解硬件约束)
    ▼
  第4章 (调度设计与优化)
```

### AI系统研究者
```
关注: 硬件-软件协同优化的全过程
核心路径:
  第1-2章 (理论基础)
    ▼
  第3章全部 (硬件架构与机制)
    ▼
  第4章全部 (调度与优化)
    ▼
  对比与分析：硬件约束如何影响调度决策
```

## 快速定位工作表

需要找...? 看这里:

| 需要 | 位置 | 关键章节 |
|-----|-----|--------|
| 硬件性能参数 | 第3章 | 3.2, 3.3, 3.6 |
| 硬件约束模型 | 第3章 | 3.2, 3.4, 3.5 |
| 调度算法 | 第4章 | 4.2, 4.4 |
| 性能评估方法 | 第1-2章 | 1.5, 2.7 |
| 模拟器框架 | 第2章 | 2.1-2.4 |
| 协同优化案例 | 第4章 | 4.5, 4.7 |
| 方法论 | 附录 | CODESIGN_FRAMEWORK.md |
